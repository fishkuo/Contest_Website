<!DOCTYPE html>
<html lang="en">
    <head>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Table</title>
    </head>

    <body>
        <select id="cityList" onchange="buildPage()">
            <option value="基隆市">基隆市</option>
            <option selected="selected" value="臺北市">臺北市</option>
            <option value="新北市">新北市</option>
            <option value="桃園市">桃園市</option>
            <option value="新竹縣">新竹縣</option>
            <option value="新竹市">新竹市</option>
            <option value="苗栗縣">苗栗縣</option>
            <option value="臺中市">臺中市</option>
            <option value="彰化縣">彰化縣</option>
            <option value="雲林縣">雲林縣</option>
            <option value="南投縣">南投縣</option>
            <option value="嘉義縣">嘉義縣</option>
            <option value="嘉義市">嘉義市</option>
            <option value="臺南市">臺南市</option>
            <option value="高雄市">高雄市</option>
            <option value="屏東縣">屏東縣</option>
            <option value="宜蘭縣">宜蘭縣</option>
            <option value="花蓮縣">花蓮縣</option>
            <option value="臺東縣">臺東縣</option>
            <option value="金門縣">金門縣</option>
            <option value="澎湖縣">澎湖縣</option>
       </select>
        <table id="review" border="1"></table>
    </body>

    <script>
        $(document).ready(function () {
            buildPage();
        });

        function buildPage() {                       
            var list = document.getElementById("cityList");
            var city = list.value;           
            $.ajax({
                url:'/get_reviews?city='+city,
                type:'GET',
                success:function(response){
                    $("#review").empty(); 
                    buildHtmlTable("#review", response);
                }
            });
        }

        function buildHtmlTable(selector, myList) {
            var columns = addAllColumnHeaders(myList, selector);

            for (var i = 0; i < myList.length; i++) {
                var row$ = $("<tr/>");
                for (var colIndex = 0; colIndex < columns.length; colIndex++) {
                    var cellValue = myList[i][columns[colIndex]];
                    if (cellValue == null) cellValue = "";
                    row$.append($("<td/>").html(cellValue));
                }
                $(selector).append(row$);
            }
        }

        function addAllColumnHeaders(myList, selector) {
            var columnSet = [];
            var headerTr$ = $("<tr/>");

            for (var i = 0; i < myList.length; i++) {
                var rowHash = myList[i];
                for (var key in rowHash) {
                    if ($.inArray(key, columnSet) == -1) {
                        columnSet.push(key);
                        headerTr$.append($("<th/>").html(key));
                    }
                }
            }
            $(selector).append(headerTr$);

            return columnSet;
        }
    </script>
</html>
