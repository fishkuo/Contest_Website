<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>公托評價系統</title>
        <link rel="stylesheet" href="css/form.css" />
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    </head>

    <body>
        <div class="container">
            <form class="form" action="/add_review" method="POST">
                <div class="city">
                    <label for="city">縣市：</label>
                    <select name="city" id="city_menu">
                        <option value="請選擇">請選擇縣市</option>
                        <option value="基隆市">基隆市</option>
                        <option value="臺北市">臺北市</option>
                        <option value="新北市">新北市</option>
                        <option value="桃園市">桃園市</option>
                        <option value="新竹縣">新竹縣</option>
                        <option value="新竹市">新竹市</option>
                        <option value="苗栗縣">苗栗縣</option>
                        <option value="臺中市">臺中市</option>
                        <option value="彰化縣">彰化縣</option>
                        <option value="雲林縣">雲林縣</option>
                        <option value="南投縣">南投縣</option>
                        <option value="嘉義縣">嘉義縣</option>
                        <option value="嘉義市">嘉義市</option>
                        <option value="臺南市">臺南市</option>
                        <option value="高雄市">高雄市</option>
                        <option value="屏東縣">屏東縣</option>
                        <option value="宜蘭縣">宜蘭縣</option>
                        <option value="花蓮縣">花蓮縣</option>
                        <option value="臺東縣">臺東縣</option>
                        <option value="金門縣">金門縣</option>
                        <option value="澎湖縣">澎湖縣</option>
                    </select>
                </div>
                <div class="fac-name">
                    <label for="fac-name">名稱：</label>
                    <select name="name" id="id_menu">
                        <option value="請選擇">請選擇機構名稱</option>
                    </select>
                </div>
                <div class="rating">
                    <label for="rating">評分：</label>
                    <input type="number" placeholder="請輸入評分(1~10)" name="rating" min="1" max="10" />
                </div>
                <div class="submit-button">
                    <button type="submit">送出評分</button>
                </div>
               
            </form>
        </div>
       <div class="recommend-table">
        <table id="recommend" border="1">
            <div class="table-header">本市評分最高的五所幼兒園</div>
        </table>
       </div>

        <script>
            function buildHtmlTable(selector, myList) {
                var columns = addAllColumnHeaders(myList, selector);

                for (var i = 0; i < myList.length; i++) {
                    var row$ = $("<tr/>");
                    for (var colIndex = 0; colIndex < columns.length; colIndex++) {
                        var cellValue = myList[i][columns[colIndex]];
                        if (cellValue == null) cellValue = "";
                        row$.append($("<td/>").html(cellValue));
                    }
                    $(selector).append(row$);
                }
            }

            function addAllColumnHeaders(myList, selector) {
                var columnSet = [];
                var headerTr$ = $("<tr/>");

                for (var i = 0; i < myList.length; i++) {
                    var rowHash = myList[i];
                    for (var key in rowHash) {
                        if ($.inArray(key, columnSet) == -1) {
                            columnSet.push(key);
                            headerTr$.append($("<th/>").html(key));
                        }
                    }
                }
                $(selector).append(headerTr$);

                return columnSet;
            }

            var city = document.getElementById("city_menu");
            city.addEventListener("change", function () {
                $(document).ready(function () {
                    var Table = document.getElementById("recommend");
                    Table.innerHTML = "";
                    $.get("/get_city?city=" + city.value, function (data, status) {
                        buildHtmlTable("#recommend", data);
                    });
                });
            });
        </script>
        <script src="dynamic.js"></script>
        <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC&display=swap" rel="stylesheet" />
    </body>
</html>
